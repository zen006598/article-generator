# 多考試類型文章生成器 - 任務規劃文檔

## 項目概述

### 目標
基於 FastAPI 和多 LLM 提供商（OpenAI GPT、Google Gemini）開發一個支援 TOEIC、GRE、IELTS、SAT 等多種考試標準的閱讀文章自動生成系統。

### 核心功能
- 支援四種考試類型的文章生成
- 多 LLM 提供商支援（OpenAI、Gemini）
- 動態 Prompt 模板系統
- 參數化文章生成（主題、難度、字數、段落數）
- 完整的 API 介面和錯誤處理

## 項目結構設計

```
articleGenerator/
├── main.py                     # FastAPI 應用入口
├── app/
│   ├── __init__.py
│   ├── api/
│   │   ├── __init__.py
│   │   └── routes/
│   │       ├── __init__.py
│   │       └── generate.py     # POST /generate API 端點
│   ├── core/
│   │   ├── __init__.py
│   │   ├── config.py          # 配置管理和環境變數
│   │   └── exceptions.py      # 自定義異常類
│   ├── models/
│   │   ├── __init__.py
│   │   ├── request.py         # Pydantic 請求模型
│   │   └── response.py        # Pydantic 回應模型
│   ├── services/
│   │   ├── __init__.py
│   │   ├── llm_service.py     # LLM 統一調用服務
│   │   ├── template_service.py # 動態模板管理服務
│   │   └── article_generator.py # 核心文章生成邏輯
│   └── utils/
│       ├── __init__.py
│       └── validators.py      # 參數驗證工具
├── configs/
│   └── exam_configs.json     # 考試配置文件
├── templates/
│   └── prompt_templates.py   # Prompt 模板定義
├── tests/
│   ├── __init__.py
│   ├── test_api.py           # API 測試
│   ├── test_services.py      # 服務層測試
│   └── test_validators.py    # 驗證器測試
├── requirements.txt
├── Dockerfile
├── .env.example
└── README.md
```

## 開發階段規劃

### ✅ Phase 1: 基礎架構 (Week 1-2) - **已完成** ✅

#### ✅ 任務 1.1: 項目初始化 - **已完成**
**目標**: 建立項目基礎結構和開發環境

**具體步驟**:
1. ✅ 初始化 Python 項目結構
2. ✅ 配置 pyproject.toml
3. ✅ 建立基本資料夾結構
4. ✅ 設定環境變數範本 (.env.example)

**輸出物**:
- ✅ 完整的專案資料夾結構
- ✅ pyproject.toml 包含所需套件
- ✅ .env.example 環境變數範本

**驗收標準**:
- ✅ 項目結構符合設計規範
- ✅ 可成功安裝所有相依套件
- ✅ 環境變數範本包含所有必要配置

#### ✅ 任務 1.2: FastAPI 基礎設定 - **已完成**
**目標**: 搭建 FastAPI 應用基礎架構

**具體步驟**:
1. ✅ 建立 main.py FastAPI 應用入口
2. ✅ 設定基本中間件 (CORS, 日誌等)
3. ✅ 建立健康檢查端點 (/health)
4. ✅ 配置 Pydantic 設定和環境變數管理
5. ✅ 建立基本的異常處理器

**輸出物**:
- ✅ main.py 應用入口
- ✅ app/core/config.py 配置管理
- ✅ app/core/exceptions.py 異常定義
- ✅ 基本 API 架構

**驗收標準**:
- ✅ FastAPI 應用可成功啟動
- ✅ 健康檢查端點正常回應
- ✅ 環境變數正確載入
- ✅ 基本錯誤處理機制運作

#### ✅ 任務 1.3: OpenAI API 整合 - **已完成**
**目標**: 整合 OpenAI API 服務

**具體步驟**:
1. ✅ 建立 LLM 服務基礎類別
2. ✅ 實作 OpenAI API 調用邏輯
3. ✅ 實作 token 使用統計
4. ✅ 建立連接測試和錯誤處理
5. ✅ 配置 API 金鑰管理

**輸出物**:
- ✅ app/services/llm_service.py LLM 服務類別
- ✅ OpenAI API 整合邏輯
- ✅ Token 使用統計功能

**驗收標準**:
- ✅ 可成功調用 OpenAI API
- ✅ Token 使用統計準確
- ✅ API 錯誤處理完善
- ✅ API 金鑰安全管理

#### ✅ 任務 1.4: TOEIC 考試類型實作 - **已完成**
**目標**: 完成 TOEIC 考試類型的完整功能

**具體步驟**:
1. ✅ 建立 TOEIC 考試配置
2. ✅ 設計 TOEIC prompt 模板
3. ✅ 實作參數驗證邏輯
4. ✅ 建立文章生成核心邏輯
5. ✅ 實作主題和難度分數驗證

**輸出物**:
- ✅ configs/exam_configs.json TOEIC 配置
- ✅ templates/prompt_templates.py TOEIC 模板
- ✅ app/utils/validators.py 驗證器
- ✅ app/services/article_generator.py 生成器

**驗收標準**:
- ✅ TOEIC 所有主題都能正確生成文章
- ✅ 難度分數驗證正確 (10-990)
- ✅ 生成文章符合字數和段落要求
- ✅ Business English 語調和內容適當

#### ✅ 任務 1.5: API 端點實作 - **已完成**
**目標**: 實作 POST /generate API 端點

**具體步驟**:
1. ✅ 建立請求和回應的 Pydantic 模型
2. ✅ 實作 /generate 端點邏輯
3. ✅ 整合參數驗證和文章生成
4. ✅ 實作回應格式和錯誤處理
5. ✅ 添加 API 文檔註解

**輸出物**:
- ✅ app/models/request.py 請求模型
- ✅ app/models/response.py 回應模型
- ✅ app/api/routes/generate.py API 端點
- ✅ 完整的 API 文檔

**驗收標準**:
- ✅ API 端點正確處理所有參數
- ✅ 回應格式符合 PRD 規範
- ✅ 錯誤處理完善且有意義的錯誤訊息
- ✅ Swagger 文檔自動生成且完整

**Phase 1 完成總結**:
- 🎉 所有基礎架構已建立完成
- ✅ FastAPI 應用程式正常運行 (http://localhost:8000)
- ✅ TOEIC 文章生成功能完全測試通過
- ✅ API 端點測試成功，包括 /generate、/exam-types、/health
- ✅ 已支援 TOEIC、IELTS、TOEFL 三種考試類型的基礎配置
- ✅ 完整的錯誤處理和驗證機制
- ✅ OpenAI API 整合成功並可生成高質量文章

### Phase 2: 多考試支援 (Week 3-4) - **待開始**

#### 任務 2.1: GRE、IELTS、SAT 考試類型擴展
**目標**: 擴展支援其他三種考試類型

**具體步驟**:
1. 擴展考試配置文件
2. 為每種考試設計專用 prompt 模板
3. 實作各考試的特殊驗證邏輯
4. 測試各考試類型的文章生成
5. 優化各考試的內容品質

**輸出物**:
- 完整的四種考試配置
- 每種考試的專用模板
- 考試特定的驗證器

**驗收標準**:
- 四種考試類型都能正確生成文章
- 每種考試的難度分數範圍正確
- 生成內容符合各考試的特色和要求
- 學術語調和專業度適當

#### 任務 2.2: 動態模板系統
**目標**: 建立靈活的動態 prompt 模板系統

**具體步驟**:
1. 設計模板引擎架構
2. 實作變數替換和條件邏輯
3. 建立模板驗證和錯誤處理
4. 建立模板測試工具

**輸出物**:
- app/services/template_service.py 模板服務
- 動態模板引擎

**驗收標準**:
- 模板變數正確替換
- 條件邏輯正確執行
- 模板錯誤有清楚的錯誤訊息
- 模板載入效能良好

#### 任務 2.3: Gemini API 整合
**目標**: 透過 OpenAI SDK 整合 Google Gemini API

**具體步驟**:
1. 研究 Gemini API 透過 OpenAI SDK 的調用方式
2. 擴展 LLM 服務以支援多提供商
3. 實作提供商切換邏輯
4. 建立 Gemini 特定的錯誤處理
5. 測試兩個提供商的一致性

**輸出物**:
- 多提供商支援的 LLM 服務
- Gemini API 整合邏輯
- 提供商切換機制

**驗收標準**:
- 可成功調用 Gemini API
- 兩個提供商的回應格式一致
- 提供商切換功能正常
- Gemini 特定錯誤處理完善

### Phase 3: 品質與效能 (Week 5-6)

#### 任務 3.1: 完善錯誤處理機制
**目標**: 建立完整的錯誤處理和回應系統

**具體步驟**:
1. 定義所有錯誤代碼和訊息
2. 建立錯誤日誌
3. 建立錯誤回復機制

**輸出物**:
- 完整的異常類別定義
- 錯誤處理中間件
- 錯誤日誌系統

**驗收標準**:
- 所有錯誤都有明確的錯誤代碼
- 錯誤訊息對用戶友善且有幫助
- 錯誤日誌完整且可追蹤
 
#### 任務 3.2: 測試框架建立
**目標**: 建立完整的單元測試

**具體步驟**:
1. 設定 pytest 測試框架
2. 建立單元測試 (覆蓋率 > 85%)
3. 建立 API 整合測試
4. 建立 LLM 服務的模擬測試
5. 設定持續整合測試

**輸出物**:
- 完整的測試套件
- 測試覆蓋率報告

**驗收標準**:
- 單元測試覆蓋率達到 85% 以上
- 測試結果清楚且可重現

#### 任務 3.3: 效能優化
**目標**: 優化系統效能和資源使用

**具體步驟**:
1. 優化 LLM API 調用效能
2. 實作併發請求處理

**輸出物**:
- 併發處理機制

**驗收標準**:
- 支援 100 個併發請求
- 記憶體使用穩定

#### 任務 3.4: 日誌系統
**目標**: 建立完整的日誌

**具體步驟**:
1. 實作結構化日誌系統
2. 實作健康檢查端點

**輸出物**:
- 日誌系統
- 健康檢查機制

**驗收標準**:
- 日誌格式統一且易於分析

#### 任務 3.5: 容器化部署
**目標**: 完成 Docker 容器化部署配置

**具體步驟**:
1. 建立 Dockerfile
2. 優化鏡像大小和啟動時間
3. 設定環境變數管理
4. 建立部署文檔

**輸出物**:
- Dockerfile
- 部署文檔

**驗收標準**:
- Docker 鏡像可成功建立和執行
- 容器啟動時間 < 30 秒
- 環境變數正確傳遞
- 部署文檔清楚易懂

## 時程安排

| 階段    | 週數     | 主要里程碑                    |
| ------- | -------- | ----------------------------- |
| Phase 1 | Week 1-2 | 基礎架構完成，TOEIC 功能上線  |
| Phase 2 | Week 3-4 | 四種考試全支援，多 LLM 提供商 |
| Phase 3 | Week 5-6 | 品質保證，上線準備完成        |

## 風險評估與應對策略

### 高風險項目
1. **LLM API 穩定性**
   - 風險：API 服務中斷或限流
   - 應對：實作重試機制和多提供商備援

2. **文章品質一致性**
   - 風險：不同模型生成品質差異
   - 應對：建立品質評估機制和模板優化

3. **效能瓶頸**
   - 風險：併發請求處理能力不足
   - 應對：實作快取和非同步處理

### 中風險項目
1. **Gemini API 整合複雜度**
   - 風險：透過 OpenAI SDK 調用可能有限制
   - 應對：提前驗證可行性，準備備選方案

2. **測試覆蓋率達標**
   - 風險：複雜邏輯測試困難
   - 應對：分階段測試，使用模擬和假資料

## 成功指標

### 功能指標
- 支援 4 種考試類型，每種至少 6 個主題
- API 回應時間 < 10 秒
- 系統可用性 > 99%
- 測試覆蓋率 > 85%

### 品質指標
- 生成文章符合考試標準
- 錯誤處理完善，無未捕捉異常
- 文檔完整且易於理解
- 代碼符合最佳實踐

這個任務規劃文檔將作為開發過程中的指導方針，確保項目按時高品質交付。